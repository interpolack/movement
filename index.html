<html>
<script src='js/d3.js'></script>
<script src='js/queue.js'></script>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: 'Helvetica Neue';
  text-transform: uppercase;
  font-size: 8px;
  letter-spacing: 0.5px;
}
</style>
<body>
</body>
<script>

var width = window.innerWidth
var height = window.innerHeight

var svg = d3.select('body').append('svg')
  .attr('width', width)
  .attr('height', height)

queue(1)
  .defer(d3.json, 'data/movements.json')
  .defer(d3.json, 'data/points.json')
  .awaitAll(function(error, results){
    var movements = results[0]
    var points = results[1]

    console.log(movements)

    var movement = svg.selectAll('.movement')
      .data(movements)
    var movementEnter = movement
      .enter()
      .append('g')
      .attr('transform', function(d,i){ return 'translate(' + (600 + points[d.name][0] * 100) + ',' + (500 + points[d.name][1] * 150) + ')'})
      .attr('class', 'movement')
    movementEnter.append('text')
      .text(function(d){ return d.name })
      .attr('x', 30)
    movementEnter.each(function(movement, i) {
      var ripples = d3.select(this).selectAll('.ripple')
        .data(movement.values)
      ripples.enter()
        .append('circle')
        .attr('r', function(d){
          var split = d.date.split("/")
          return ((parseInt(split[2] - 4) * 12) + parseInt(split[0])) / 25.0
        })
        .attr('opacity', function(d){ return d.google_trend_count / 5000.0 })
        .attr('stroke-width', 1)
        .attr('stroke', "#000")
        .attr('fill', 'none')
        .attr('cx', 20)
    })

  })
</script>
</html>
